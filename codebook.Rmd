---
title: "CodeBook"
author: "aarvil"
date: "January 25, 2016"
output: html_document
---

## Code Book

This code book describes the variables for the output files of the run_analysis.R script, tidydataset.txt and tidydataset-mean.txt. 

This is in regards to the course project from JHU's Getting and Cleaning Data Course in Coursera.org. 

Please refer to [README] (readme.md) for additional details. 

### Variables for TIDYDATASET.TXT

This is a description of variables of the dataset in TIDYDATASET.TXT. This dataset is an output of run_analysis.R. 

For more detail regarding measurements, please refer to original documentation.Please refer to [README] (readme.md) for additional details. 

| [] | Original Feature Name                | Dataset column name                  |
|----|--------------------------------------|--------------------------------------|
| 1  | tBodyAcc-mean()-X                    | tBodyAcc-mean-X                      |
| 2  | tBodyAcc-mean()-Y                    | tBodyAcc-mean-Y                      |
| 3  | tBodyAcc-mean()-Z                    | tBodyAcc-mean-Z                      |
| ...| ...                                  | ...                                  |
| ...| additional mean and std measurements | ...                                  |
| ...| ...                                  | ...                                  |
| 87 |                                      | activity                             |
| 88 |                                      | subject                              |


## Variables for TIDYDATASET-MEAN.TXT

This is a description of variables of the dataset in TIDYDATASET-MEAN.TXT. This dataset is an output of run_analysis.R. 

Please note that this dataset is grouped by activity and subject. It's a short and wide dataset, containing measurements for each activity and each subject. 

| column                | description                                               | 
| ------------          | --------------------------------------------------------  |
| activity              | Activity label                                            |
| subject               | Id of subject                                             |
| tBodyAcc-mean()-X     | Average of each variable (grouped by activity & subject)  |
| ...                   | ...                                                       |
| additional measurement| ...                                                       |
| ...                   | ...                                                       |

## Transformation
```{r}
library(dplyr)
library(stringr)
```
### STEP 1: LOAD DATA. -----------------------------------
```{r}
message("Loading data...")
```
## Read training dataset. 
```{r}
traindata <- read.table(file = "./UCI HAR Dataset/train/X_train.txt")
trainlabels <- read.table(file = "./UCI HAR Dataset/train/y_train.txt")
trainsubject <- read.table(file = "./UCI HAR Dataset/train/subject_train.txt")
```
## Read test dataset. 
```{r}
testdata <-read.table(file = "./UCI HAR Dataset/test/X_test.txt")
testlabels <- read.table(file = "./UCI HAR Dataset/test/y_test.txt")
testsubject <- read.table(file = "./UCI HAR Dataset/test/subject_test.txt")
```
# Read feature (column) name data. 
```{r}
features <- read.table(file = "./UCI HAR Dataset/features.txt", sep = " ")
```
## Read activity labels
```{r}
activitylabels <- read.table(file = "./UCI HAR Dataset/activity_labels.txt")
```
## Use data tables to make it easier to work with datasets. 
```{r}
traindata <- tbl_dt(traindata)
trainlabels <- tbl_dt(trainlabels)
trainsubject <- tbl_dt(trainsubject)
testdata <- tbl_dt(testdata)
testlabels <- tbl_dt(testlabels)
testsubject <- tbl_dt(testsubject)
features <- tbl_dt(features)
activitylabels <- tbl_dt(activitylabels)

message("Loading successful.")
```

### STEP 2: DATA TRANSFORMATION -------------------------------
```{r}
message("Starting data transformation...")
```
## 2.A: Apply descriptive column names to datasets using data from features.txt.

# Coerce feature into characters in order to use them for column names. 
```{r}
features$V2 <- as.character(features$V2) 
```
# Remove parentesis from variable names to increase readability. 
```{r}
features <- mutate(features, V3 = str_replace(features$V2, "\\(\\)", "")) 
```
# Apply feature as column names to training and test datasets. 
```{r}
colnames(testdata) <- features$V3
colnames(traindata) <- features$V3
```

# 2.B: Extract measurements on the mean and standard deviation for each measurement.
```{r}
test2 <- select(testdata, contains("mean"), contains("std"))
train2 <- select(traindata, contains("mean"), contains("std"))
```
# 2.C: Add activity and subject variables into datasets
```{r}
test2 <- mutate(test2, activity = testlabels, subject = testsubject)
train2 <- mutate(train2, activity = trainlabels, subject = trainsubject) 
```
# 2.D: Merge the training and the test sets to create one data set.
```{r}
completedata <- rbind_list(test2, train2)
```
# 2.E: Replace activity id's with descriptive activity names.
```{r}
activity3 <- character(0)
activitylabels$V2 <- as.character(activitylabels$V2)

for(i in 1:length(completedata$activity)) {
      activity3 <- c(activity3, activitylabels$V2[completedata$activity[i]])
}
completedata$activity <- activity3

message("Transformation complete.")
```
# 2.F: Write data into a text file tidydata.txt in the working directory. 
```{r}
message("Writing data to file tidydataset.txt in working directory.")
write.table(completedata, file = "tidydataset.txt", row.names = FALSE)
message("tidydataset.txt file successfully created.")

```
### STEP 3: From final dataset, create a second, independent tidy data set with the average of each variable for each activity and each subject.
```{r}
message("Creating new dataset with average of each variable for each activity and each subject.")
```
# Group data by activity and subject. 
```{r}
completedata <- group_by(completedata, activity, subject)
```
# Get the average of each variable for each activity and each subject. 
```{r}
meanbyactivityandsubject <- summarise_each(completedata, funs(mean))
```
# Write data into text file tidydataset-means.txt in working directory.
```{r}
message("Writing data to file tidydataset-means.txt in working directory.")
write.table(meanbyactivityandsubject, file = "tidydataset-means.txt", row.names = FALSE)      
message("tidydataset-means.txt file successfully created.")
```
